# Gemini CLI 架构概述

本文档对 Gemini CLI 的架构进行了高级概述。

## 核心组件

Gemini CLI 主要由两个核心软件包和一系列工具组成，系统可以在处理命令行输入时使用这些工具：

1.  **CLI 软件包 (`packages/cli`):**

    - **目的:** 包含 Gemini CLI 面向用户的部分，例如处理初始用户输入、呈现最终输出和管理整体用户体验。
    - **软件包中的关键功能:**
      - [输入处理](./cli/commands.zh.md)
      - 历史记录管理
      - 显示渲染
      - [主题和 UI 自定义](./cli/themes.zh.md)
      - [CLI 配置设置](./cli/configuration.zh.md)

2.  **核心软件包 (`packages/core`):**

    - **目的:** 作为 Gemini CLI 的后端。它接收从 `packages/cli` 发送的请求，协调与 Gemini API 的交互，并管理可用工具的执行。
    - **软件包中的关键功能:**
      - 与 Google Gemini API 通信的 API 客户端
      - 提示构建和管理
      - 工具注册和执行逻辑
      - 对话或会话的状态管理
      - 服务器端配置

3.  **工具 (`packages/core/src/tools/`):**
    - **目的:** 这些是扩展 Gemini 模型功能的独立模块，使其能够与本地环境（例如文件系统、shell 命令、网页抓取）进行交互。
    - **交互:** `packages/core` 根据 Gemini 模型的请求调用这些工具。

## 交互流程

与 Gemini CLI 的典型交互流程如下：

1.  **用户输入:** 用户在终端中输入提示或命令，由 `packages/cli` 管理。
2.  **向核心层发送请求:** `packages/cli` 将用户输入发送到 `packages/core`。
3.  **请求处理:** 核心软件包：
    - 为 Gemini API 构建适当的提示，其中可能包含对话历史和可用的工具定义。
    - 将提示发送到 Gemini API。
4.  **Gemini API 响应:** Gemini API 处理提示并返回响应。该响应可能是直接的答案，也可能是使用某个可用工具的请求。
5.  **工具执行 (如适用):**
    - 当 Gemini API 请求使用工具时，核心软件包准备执行该工具。
    - 如果所请求的工具会修改文件系统或执行 shell 命令，则会首先向用户显示该工具的详细信息及其参数，并且用户必须批准执行。
    - 只读操作（例如读取文件）可能不需要用户明确确认即可继续。
    - 一旦确认，或者如果不需要确认，核心软件包将在相关工具中执行相应的操作，并将结果由核心软件包发送回 Gemini API。
    - Gemini API 处理工具结果并生成最终响应。
6.  **向 CLI 响应:** 核心软件包将最终响应发送回 CLI 软件包。
7.  **向用户显示:** CLI 软件包对响应进行格式化，并在终端中显示给用户。

## 关键设计原则

- **模块化:** 将 CLI（前端）与核心（后端）分离，有助于独立开发和未来的扩展（例如，为同一后端开发不同的前端）。
- **可扩展性:** 工具系统被设计为可扩展的，允许添加新功能。
- **用户体验:** CLI 专注于提供丰富和交互式的终端体验。 