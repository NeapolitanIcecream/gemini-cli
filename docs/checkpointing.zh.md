# 检查点 (Checkpointing)

Gemini CLI 包含一个检查点功能，它会在由 AI 驱动的工具进行任何文件修改之前，自动保存您项目状态的快照。这使您可以安全地进行实验和应用代码更改，并能随时恢复到工具运行之前的状态。

## 工作原理

当您批准一个会修改文件系统（如 `write_file` 或 `replace`）的工具时，CLI 会自动创建一个"检查点"。该检查点包含：

1.  **一个 Git 快照：** 系统会在您主目录 (`~/.gemini/history/<project_hash>`) 下的一个特殊的影子 Git 仓库中创建一个提交。这个快照会捕捉您项目文件在那一刻的完整状态。它 **不会** 影响您自己项目的 Git 仓库。
2.  **对话历史：** 到目前为止您与助手的所有对话内容都会被保存。
3.  **工具调用：** 即将被执行的具体工具调用也会被存储。

如果您想撤销更改或返回上一步，可以使用 `/restore` 命令。恢复一个检查点将会：

- 将您项目中的所有文件恢复到快照中捕捉的状态。
- 在 CLI 中恢复对话历史。
- 重新提出原始的工具调用，让您可以再次运行、修改或忽略它。

所有检查点数据，包括 Git 快照和对话历史，都存储在您的本地计算机上。Git 快照存储在影子仓库中，而对话历史和工具调用则保存在您项目临时目录下的一个 JSON 文件中，通常位于 `~/.gemini/tmp/<project_hash>/checkpoints`。

## 启用该功能

检查点功能默认是禁用的。要启用它，您可以使用命令行标志或编辑您的 `settings.json` 文件。

### 使用命令行标志

您可以在启动 Gemini CLI 时使用 `--checkpointing` 标志来为当前会话启用检查点功能：

```bash
gemini --checkpointing
```

### 使用 `settings.json` 文件

要为所有会话默认启用检查点功能，您需要编辑您的 `settings.json` 文件。

将以下键添加到您的 `settings.json` 文件中：

```json
{
  "checkpointing": {
    "enabled": true
  }
}
```

## 使用 `/restore` 命令

一旦启用，检查点就会自动创建。您可以使用 `/restore` 命令来管理它们。

### 列出可用的检查点

要查看当前项目所有已保存的检查点列表，只需运行：

```
/restore
```

CLI 将会显示一个可用检查点文件的列表。这些文件名通常由时间戳、被修改的文件名和即将运行的工具名称组成（例如，`2025-06-22T10-00-00_000Z-my-file.txt-write_file`）。

### 恢复指定的检查点

要将您的项目恢复到指定的检查点，请使用列表中的检查点文件名：

```
/restore <checkpoint_file>
```

例如：

```
/restore 2025-06-22T10-00-00_000Z-my-file.txt-write_file
```

运行该命令后，您的文件和对话将立即恢复到创建检查点时的状态，并且原始的工具提示将重新出现。 